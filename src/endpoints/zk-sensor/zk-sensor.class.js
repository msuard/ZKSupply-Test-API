const ElGamal = require('../../services/crypto/elgamal');

const sk = "9026186636265831171311126134124033683800066920032025913986729905274838418504836547212202504391943805215862902996866026377285015551094549528724992524634930618014418938450947424448440307603062993067239519328584535330138267457137782219019043757916386272835054776000111183660979565096627719518650072748425601458656798757472796588817216415543425645233259095187395635022513287593817321791678989182559119829422628467304527861320550190759119156385635521110764122554168017440861076228436092958086371190432309664799423811095678793212248428353386846865517213398861943755280321246657809563629208218523890190515076149298944600037";
const p = "28365527646097161458413738661957691010692997400282407966999417053192505626062757891471789344147539809945735410263785341914920216315583322460021021710065659202392602403625751569884584203861667996709255125985366483644600954536323631054809738667270692943775403308220798062429774145758205264185597632397493593131386892913441784136417996817111475164695825929714227364062937920495458772657467672269767540092857933103122263952766469657148831891639018631897214015217747121389035422872347859768051933749072523271137736650694505825523713129367528228940317820178256623512044793535146342932459887854447594707146468574979426912067";

class Service {

  constructor (app, options) {
    this.options = options || {};
    this.app = app;

  }

  async create(data, params) {

    // console.log("\nTEMPERATURE: " + data.temperature + " degC\n");
    console.log("\nReceived encrypted temperature data point:\n --> c1 = " + data.c1 + "\n --> c2 = " + data.c2);

    console.log("\nDecrypting...\n");

    const plaintext = ElGamal.decryptMessage(data.c1, data.c2, sk, p);

    const temp = 0.001 * parseInt(plaintext, 10);

    console.log("\nTemperature = " + temp + " decC\n");

    return 200;
  }


  async find(params){

    const { p, g, A, x } = await ElGamal.generateKeyPairAsync();

    return({ p, g, A, x })

  }

}

module.exports = function (app, options) {
  return new Service(app, options);
};

module.exports.Service = Service;
