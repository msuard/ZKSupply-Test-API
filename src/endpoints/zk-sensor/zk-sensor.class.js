const ElGamal = require('../../services/crypto/elgamal');

const sk = "1073570526646861367271947072391026552179520433493348301664729956404805288511154224490777034339822489501299004626719883636934354970144882521566651680401486165933127347012202198185714069104104999033195275859024760996169200400583618628925682826347258891018390689222773863904823189591954849267677856609067331723337354844102812071225467261803953522275340804977677187440970024373521096020575876812284970079205669687802414257027812113571571916984441519230124641073297308846917311113405013822966120806524391370832339908501708176806051610230513932444308775501082199747097159972610881227034650283484631055975856283914582220343";
const p = "16256774906930626117477931531485045516464979719831746094563618006139340139671568509312248268379360217989721457974833553288481974177769842323527521375570010456751735885028480256202054643554514137100034826086408091060816889618427527080472437807323000645806869237149251566073453180251298440006102139872533243527135581959548842662578058275485265280126610773224400213041590228364298736995180099639888094870590953191272117867719642706662492457964810664010687076947695483221457811658713400077465177307004627476861183252391227256462987752842088125793720334687501438468742529463731004741019600630095968548178638104477500174423";

class Service {

  constructor (app, options) {
    this.options = options || {};
    this.app = app;

  }

  async create(data, params) {

    // console.log("\nTEMPERATURE: " + data.temperature + " degC\n");
    console.log("\nReceived encrypted temperature data point:\n --> c1 = " + data.c1 + "\n --> c2 = " + data.c2);

    console.log("\nDecrypting...\n");

    const plaintext = ElGamal.decryptMessage(data.c1, data.c2, sk, p);

    const temp = 0.001 * parseInt(plaintext, 10);

    console.log("\nTemperature = " + temp + " decC\n");

    return 200;
  }


  async find(params){

    const { p, g, A, x } = await ElGamal.generateKeyPairAsync();

    return({ p, g, A, x })

  }

}

module.exports = function (app, options) {
  return new Service(app, options);
};

module.exports.Service = Service;
